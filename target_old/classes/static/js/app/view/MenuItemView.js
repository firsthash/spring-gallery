define(["backbone","app/App","app/view/MenuView","app/util/animqueue"],function(c,b,a){return c.View.extend({events:{click:"onClick","click .lang>a":"onMenuClick",},tagName:"li",template:_.template($("#menu-item-template").html()),submenu:null,menu:null,initialize:function(d){b=require("app/App");a=require("app/view/MenuView");this.menu=d.menu;this.model.on("change",this.render,this)},className:function(){var d="";if(this.model.has("style")){d=this.model.get("style")}return d},render:function(){var f=this.template(this.model.toJSON());this.$el.html(f);var d=this.model.get("children");if(d.length){var e=new a({collection:d});this.submenu=e;e.parentItem=this;this.$el.append(e.render().el)}if(b.contentView.model.get("id")==this.model.get("content").get("id")){this.showContent();this.$el.addClass("active")}return this},hasContent:function(){var d=this.model.get("content");return d.notEmpty()},onMenuClick:function(d){$.get(d.currentTarget.href,function(){menuview.items.fetch()});return false},onClick:function(d){d.stopPropagation();this.doClick(d)},OPEN:0,CLOSE:1,doClick:function(d){b.workspace.navigate("show/item"+this.model.get("id"));this.showContent();this.animate(_.bind(function(){if(this.submenu&&this.$el.hasClass("active")){var e=this.submenu.items[0];e.model.get("content").notEmpty()&&e.doClick()}},this));if(this.submenu&&this.menu.active()!=this.submenu){_.each(this.submenu.items,function(e){e.$el.removeClass("active")})}},showContent:function(){var d=this.model.get("content");if(d.notEmpty()){b.contentView.model.set(d.toJSON());this.menu.active(this.menu);b.contentControls.toggle()}},animate:function(d){if(this.menu.parentItem&&!this.menu.parentItem.$el.hasClass("active")){console.log("parent not active");this.menu.parentItem.animate(_.bind(function(){this.doAnimate(d)},this))}else{this.doAnimate(d)}},doAnimate:function(h){var g=null;_.each(this.menu.items,function(i){if(i.$el.hasClass("active")&&i!=this){g=i}},this);var f=g&&g.submenu?g.submenu.$el:null;var e=this.submenu?this.submenu.$el:null;if(!f&&!e){this&&this.$el.addClass("active");g&&g.$el.removeClass("active");return}var d=[{el:f,},{el:e,},];$.slideQueue(d,{callback:function(i){_.each(i,function(k,j){k&&k.$el.toggleClass("active");k&&k.submenu&&k.submenu.$el.css("display","")});h&&h()}},[this,g])},})});